
# COCOTB variables
export COCOTB_REDUCED_LOG_FMT=1
export PYTHONPATH := test:$(PYTHONPATH)
export LIBPYTHON_LOC=$(shell cocotb-config --libpython)

all: test_pwm 

test_sim: 
	rm -rf sim_build/; mkdir sim_build/
	iverilog -o sim_build/sim.vvp -s my_design src/my_design.v -DCOCOTB_SIM
	MODULE=tb.test_my_design vvp -M $$(cocotb-config --prefix)/cocotb/libs -m libcocotbvpi_icarus sim_build/sim.vvp
	! grep failure results.xml

test_pwm: 
	rm -rf sim_build/; mkdir sim_build/
	iverilog -o sim_build/sim.vvp -s PWM src/PWM.v -DCOCOTB_SIM
	MODULE=tb.tb_PWM vvp -M $$(cocotb-config --prefix)/cocotb/libs -m libcocotbvpi_icarus sim_build/sim.vvp
	! grep failure results.xml

test_up_down_counter: 
	rm -rf sim_build/; mkdir sim_build/
	iverilog -o sim_build/sim.vvp -s up_down_counter src/up_down_counter.v -DCOCOTB_SIM
	MODULE=tb.tb_up_down_counter vvp -M $$(cocotb-config --prefix)/cocotb/libs -m libcocotbvpi_icarus sim_build/sim.vvp
	! grep failure results.xml

show_%: %.vcd tb/%.gtkw
	gtkwave $^

clean: 
	rm *vcd -rf sim_build

